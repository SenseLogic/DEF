<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Map Sorter</title>
    </head>
    <body>
        <style>
            body
            {
                padding: 0.5rem;
            }

            *
            {
                font-family: sans-serif;
                padding: 0;
                margin: 0;
            }

            .grid
            {
                min-height: calc( 100dvh - 1rem );
                width: 100%;

                display: grid;
                grid-template-rows: auto 1fr auto;
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .text
            {
                height: 100%;
                width: 100%;

                font-family: monospace;
            }
        </style>
        <div class="grid">
            <div>
                <button onclick="SortMap()">Sort map</button>
            </div>
            <div>
                <textarea class="text" id="text"></textarea>
            </div>
            <div>
                <button onclick="SortMap()">Sort map</button>
            </div>
        </div>
        <script>
            // -- CONSTANTS

            const
                TabulationText = "    ",
                TextElement = document.getElementById( "text" );

            // -- FUNCTIONS

            function GetNaturalTextComparison(
                first_text,
                second_text
                )
            {
                var
                    first_character,
                    first_character_count,
                    first_character_index,
                    first_number_text,
                    second_character,
                    second_character_count,
                    second_character_index,
                    second_number_text;

                first_character_count = first_text.length;
                second_character_count = second_text.length;
                first_character_index = 0;
                second_character_index = 0;

                while ( first_character_index < first_character_count
                        && second_character_index < second_character_count )
                {
                    first_character = first_text[ first_character_index ];
                    second_character = second_text[ second_character_index ];

                    if ( first_character === second_character )
                    {
                        ++first_character_index;
                        ++second_character_index;
                    }
                    else
                    {
                        if ( first_character >= '0'
                             && first_character <= '9'
                             && second_character >= '0'
                             && second_character <= '9' )
                        {
                            first_number_text = '';
                            second_number_text = '';

                            while ( first_character_index < first_character_count
                                    && first_text[ first_character_index ] >= '0'
                                    && first_text[ first_character_index ] <= '9' )
                            {
                                first_number_text += first_text[ first_character_index ];

                                ++first_character_index;
                            }

                            while ( second_character_index < second_character_count
                                    && second_text[ second_character_index ] >= '0'
                                    && second_text[ second_character_index ] <= '9' )
                            {
                                second_number_text += second_text[ second_character_index ];

                                ++second_character_index;
                            }

                            return parse_int( first_number_text ) - parse_int( second_number_text );
                        }
                        else if ( first_character < second_character )
                        {
                            return -1;
                        }
                        else
                        {
                            return 1;
                        }
                    }
                }

                return first_character_count - second_character_count;
            }

            // ~~

            function GetEntryComparison(
                first_entry,
                second_entry
                )
            {
                return GetNaturalTextComparison( first_entry, second_entry );
            }

            // ~~

            function CopyText(
                )
            {
                TextElement.focus();
                TextElement.select();
                document.execCommand( "copy" );
            }

            // ~~

            function GetSortedMapText(
                text
                )
            {
                var
                    entry,
                    entry_array,
                    entry_index,
                    entry_space_count,
                    line,
                    line_array,
                    line_index,
                    line_space_count,
                    sorted_text,
                    trimmed_line;

                entry_array = [];
                entry_space_count = 0;

                line_array = text.replace( "\r", "" ).replace( "\t", TabulationText ).trimEnd().split( "\n" );

                for ( line_index = 0;
                      line_index < line_array.length;
                      ++line_index )
                {
                    line = line_array[ line_index ].trimEnd();
                    trimmed_line = line.trimLeft();
                    line_space_count = line.length - trimmed_line.length;

                    if ( line_index === 0 )
                    {
                        entry_space_count = line_space_count;
                        entry_array.push( { key: line, value: "" } );
                    }
                    else if ( line_space_count <= entry_space_count
                              && trimmed_line !== "" )
                    {
                        entry_array.push( { key: line, value: "" } );
                    }
                    else
                    {
                        entry_array[ entry_array.length - 1 ].value += line + "\n";
                    }
                }

                entry_array.sort( GetEntryComparison );
                sorted_text = "";

                for ( entry_index = 0;
                      entry_index < entry_array.length;
                      ++entry_index )
                {
                    entry = entry_array[ entry_index ];
                    sorted_text += entry.key + "\n" + entry.value;
                }

                if ( sorted_text.endsWith( "\n" )
                     && !text.endsWith( "\n" ) )
                {
                    return sorted_text.slice( 0, -1 );
                }
                else
                {
                    return sorted_text;
                }
            }

            // ~~

            function SortMap(
                )
            {
                TextElement.value = GetSortedMapText( TextElement.value );
                CopyText();
            }
        </script>
    </body>
</html>
